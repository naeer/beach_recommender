{% extends "base.html" %}
{% load wagtailcore_tags %}
{% block extra_css %}
    <style>
      body{
        padding-top: 100px;
      }
    </style>
{% endblock %}

{% block content %}
{% load static wagtailcore_tags wagtailimages_tags %}
<center><h1 class="display-4">{{ page.name_title }}</h1></center>
<div>
    <center><p>{{ page.name_subtitle|richtext }}</p></center>
</div>

<!-- <center> -->
  <!-- <div class="container-fluid" style="height:100%; padding-top:3%; display: block; overflow: auto;">
    <div class="row" style="padding-bottom:1%;">
      <div class="col-4">
        <button type="button" onclick="changeTheVariableStartNorm()" id="pushMe3" class="btn btn-primary" name="button3">Start Normal</button>
      </div>
      <div class="col-4">
        <button type="button" onclick="changeTheVariableStartAI()" id="pushMe5" class="btn btn-primary" name="button5">Start AI</button>
      </div>
      <div class="col-4">
        <button type="button" onclick="changeTheVariableStop()" id="pushMe4" class="btn btn-primary" name="button4" disabled>Stop</button>
      </div>
    </div>
    <h4>If video does not load, click the below buttons:</h4>
    <center>
      <div style="margin-bottom:10px;">
        <button type="button" id="ntbtn1" class="btn btn-primary" name="button" style="color:white" disabled>View in new tab</a>
      </div>
    </center>
    <div class="videoWrapper">
        <style>
        /* .videoWrapper {
          position:absolute;
          height:100%;
          width: 100%;
        } */
        .videoWrapper iframe {
          display: block;
          height: 720px; width: 1250px; border: 2px solid #ccc;
          margin-bottom:200px;
          position: relative;
        }
      </style> -->

      <!-- <img id="frame1" style="-webkit-user-select: none;" src="../no_video/" width="800px" height="700px"> -->
      <!-- <iframe id="frame1" class="responsive-iframe"  src="../no_video/" title="YouTube video player" frameborder="0" scrolling="no" ></iframe>

    </div>
</div> -->
<!-- <div class="container-fluid" style="height: 100%; padding-top: 3%; display: flex; overflow: auto; padding-left: 1%;">
  <div class="videoWrapper">
    <style>
      .videoWrapper iframe {
        display: block;
        height: 720px;
        width: 1250px;
        border: 2px solid #ccc;
        margin-bottom: 200px;
        position: relative;
      }
    </style>
    <iframe id="frame1" class="responsive-iframe" src="../no_video/" title="YouTube video player" frameborder="0" scrolling="no"></iframe>
  </div>

  <div style="display: flex; flex-direction: column; justify-content: flex-start;">
    <div class="row" style="padding-bottom: 1%;">
      <div class="col-12">
        <button type="button" onclick="changeTheVariableStartNorm()" id="pushMe3" class="btn btn-primary" name="button3">Start Normal</button>
      </div>
      <div class="col-12">
        <button type="button" onclick="changeTheVariableStartAI()" id="pushMe5" class="btn btn-primary" name="button5">Start AI</button>
      </div>
      <div class="col-12">
        <button type="button" onclick="changeTheVariableStop()" id="pushMe4" class="btn btn-primary" name="button4" disabled>Stop</button>
      </div>
    </div>
    <center>
      <div style="margin-bottom: 10px;">
        <button type="button" id="ntbtn1" class="btn btn-primary" name="button" style="color: white" disabled>View in new tab</a>
      </div>
    </center>
  </div>
</div> -->

<div class="container-fluid" style="height: 100%; padding-top: 3%; display: flex; overflow: auto; padding-left: 1%;">
  <div class="videoWrapper">
    <style>
      .videoWrapper iframe {
        display: block;
        height: 720px;
        width: 1250px;
        border: 2px solid #ccc;
        margin-bottom: 200px;
        position: relative;
      }
    </style>
    <iframe id="frame1" class="responsive-iframe" src="" title="YouTube video player" frameborder="0" scrolling="no"></iframe>
  </div>

  <div style="display: flex; flex-direction: column; justify-content: flex-start; padding-left: 1%;">
    <style>
      .btn-toggle, .btn-newtab {
        background-color: #4285f4;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
      }

      .btn-toggle:hover, .btn-newtab:hover {
        background-color: #357ae8;
      }

      .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #a1d3ff;
        -webkit-transition: .4s;
        transition: .4s;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        -webkit-transition: .4s;
        transition: .4s;
      }

      input:checked + .slider {
        background-color: #357ae8;
      }

      input:focus + .slider {
        box-shadow: 0 0 1px #357ae8;
      }

      input:checked + .slider:before {
        -webkit-transform: translateX(26px);
        -ms-transform: translateX(26px);
        transform: translateX(26px);
      }

      /* Rounded sliders */
      .slider.round {
        border-radius: 34px;
      }

      .slider.round:before {
        border-radius: 50%;
      }
    </style>
    <div class="row" style="padding-bottom: 12%; padding-left: 1.45%;">
      <div class="col-12">
        <div class="row">
          <div class="col-xl-4 col-md-6" style="padding-left: 7.25%;">
            <label class="switch">
              <input type="checkbox" onclick="toggleVideoAI()" id="toggleButton" name="toggleButton" disabled>
              <span class="slider round"></span>
            </label>
          </div>
          <div class="col-xl-8 col-md-6" style="padding-left: 13%;">
            <span id="toggletext" class="font-weight-bold" style="font-size: 22px; display: inline-block; text-align: left;">AI</span>
          </div>
        </div>    
        <!-- <button type="button" onclick="toggleVideoAI()" id="toggleButton" class="btn btn-toggle" name="toggleButton" disabled>Video Feed</button> -->
        </div>
    </div>
    <div style="padding-bottom: 20%;">
      <button type="button" id="ntbtn1" class="btn btn-newtab" name="button" style="color: white" disabled>View in new tab</button>
    </div>
    <span id = "people" class="font-weight-light" style="padding-left: 1.45%;">People on the beach:</span>
    <span id = "bbox_count" class="font-weight-bold" style="padding-left: 1.45%;"></span>
    <br>
    <span id = "crowdedness_text" class="font-weight-light" style="padding-left: 1.45%;">Crowdedness level:</span>
    <span id = "crowdedness" class="font-weight-bold" style="padding-left: 1.45%;"></span>
  </div>
</div>


<!-- </center> -->
{% endblock %}
{% block extra_js %}
    <script type="text/javascript">
      var url = "../camera_feed/";
      document.getElementById("ntbtn1").addEventListener("click", function() {
        window.open(url, "_blank");
      });

      var videoMode = false; // Initial mode is video mode

      function toggleVideoAI() {
        var iframevar1 = document.getElementById('frame1');
        var nt1 = document.getElementById('ntbtn1');
        var toggletext = document.getElementById('toggletext')

        if (!videoMode) {
          var a = "../camera_feed/"; // Switch to video feed mode
          document.getElementById('toggleButton').textContent = "AI";
          document.getElementById('bbox_count').textContent = ""; // Clear the bounding box count
          document.getElementById('crowdedness').textContent = "" // Clear crowdedness level on the webpage
          document.getElementById('people').textContent = "" // Clear number of people text on the webpage
          document.getElementById('crowdedness_text').textContent = "" // Clear crowdedness text on the webpage
        } else {
          var a = "../camera_feed_AI/"; // Switch to AI mode
          document.getElementById('toggleButton').textContent = "Video Feed";
        }

        iframevar1.src = a;
        url = a;
        videoMode = !videoMode; // Toggle the mode

        document.getElementById('toggleButton').disabled = false;
        document.getElementById('ntbtn1').disabled = false;
      }

      // Call the toggleVideoAI() function initially to switch to the video feed mode
      toggleVideoAI();

      function updateBoundingBoxCount() {
        if (!videoMode) {
          fetch('../get_bbox_count/')
            .then(response => response.json())
            .then(data => {
              document.getElementById('bbox_count').textContent = data.bboxCount;
              document.getElementById('crowdedness').textContent = data.crowdedness;
              document.getElementById('people').textContent = "People on the beach:"
              document.getElementById('crowdedness_text').textContent = "Crowdedness level:" 
            })
            .catch(error => {
              console.error('Error:', error);
            });
        }

        setTimeout(updateBoundingBoxCount, 1000);
      }

      updateBoundingBoxCount();


    </script>
    

{% endblock %}
